<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> 小程序升级WePY2踩坑记 · 步步走</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="小程序升级wepy2记录。"><meta name="keywords" content="wepy小程序框架、use-intercept、use-promisify"><meta name="author" content="typeR"><link rel="short icon" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/favicon.ico"><link rel="stylesheet" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://bubuzou.com/atom.xml" title="步步走"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/atom.xml" title="步步走" type="application/atom+xml">
</head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/logo.svg"></a><ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">小程序升级WePY2踩坑记</h1><div class="post-info">2020-08-06<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"> </span><span>次访问</span></p></div><div class="post-content"><p>最近有个小程序项目需要迭代，但是迭代任务不多，时间比较充裕。而这个小程序最早是在 18 年的时候开发的，用的开发框架是 <code>WePY</code> 的 <code>1.7.2</code> 版本，去年也就是 <code>19</code> 年的时候 <code>WePY</code> 框架进行了升级，到了 <code>2.0</code> 版本。升级之后的 <code>WePY</code>，用 <a target="_blank" rel="noopener" href="https://wepyjs.github.io/wepy-docs/2.x/#/"><code>WePY</code></a> 官方文档的话来说：通过优化细节，引入 <code>Promise</code>、<code>Async Functions</code> 等让开发小程序项目变得更加简单，高效。基于这些背景，我和小伙伴一拍即合，决定对我们的项目进行框架升级，体验下到底 <code>WePY2</code> 能给我们带来什么。</p>
<p>本文将以项目改动为出发点，基于当前这个项目的结构和编码方式来考虑到底升级 <code>WePY2</code> 后，哪里需要改，怎么改以及有哪些需要注意的地方，通过对比 <code>2</code> 个版本的写法差异这个思路来写，不会去太较真 <code>WePY2</code> 相对于 <code>WePY1</code> 实现或原理上的区别。下面我将一条一条的列出来需要改动的点。</p>
<blockquote>
<p>本篇文章记录的是我和小伙伴这次升级框架遇到的需要改动的地方和坑，所使用的是 <code>wepy</code> 的 <code>2.1.0</code> 版本，后续如果版本升级后，本篇记录到的坑如果已经被修复了，请自行忽略本文所述的问题。另外下文中所说到的 <code>2.x</code> 版本都是指 <code>wepy_v2.1.0</code>。</p>
</blockquote>
<a id="more"></a>

<h2 id="初始化一个-WePY2-的-demo"><a href="#初始化一个-WePY2-的-demo" class="headerlink" title="初始化一个 WePY2 的 demo"></a>初始化一个 WePY2 的 demo</h2><p>由于本地还有其他项目用的是 <code>WePY_v1.7.2</code>，所以我们不能把 <code>WePY2</code> 的 <code>CLI</code> 工具安装在全局环境中，只能安装在当前项目中。官方推荐是直接用 <code>1.7.x</code> 的 <code>CLI</code> 去初始化 <code>2.0.x</code> 的项目:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wepy init standard#2.0.x zzodr</span><br></pre></td></tr></table></figure>

<p>这样就能够在本地初始化一个 <code>wepy2</code> 的项目模板，但是 <code>@wepy/core</code> 是 <code>2.0.0-alpha.16</code> 版本的，将它更新到最新的 <code>2.1.0</code> 版本，这里也一起更新下整个旧项目和新模板所用到的依赖，下面直接贴出来：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@wepy/core&quot;</span>: <span class="string">&quot;^v2.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/use-intercept&quot;</span>: <span class="string">&quot;^2.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/use-promisify&quot;</span>: <span class="string">&quot;^2.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/x&quot;</span>: <span class="string">&quot;^2.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;miniprogram-slide-view&quot;</span>: <span class="string">&quot;0.0.3&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@babel/core&quot;</span>: <span class="string">&quot;^7.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@babel/preset-env&quot;</span>: <span class="string">&quot;^7.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/babel-plugin-import-regenerator&quot;</span>: <span class="string">&quot;0.0.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/cli&quot;</span>: <span class="string">&quot;^2.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/compiler-babel&quot;</span>: <span class="string">&quot;^2.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/compiler-sass&quot;</span>: <span class="string">&quot;^2.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;@wepy/plugin-define&quot;</span>: <span class="string">&quot;^2.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;babel-eslint&quot;</span>: <span class="string">&quot;^7.2.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cross-env&quot;</span>: <span class="string">&quot;^5.1.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span>: <span class="string">&quot;^3.18.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-config-standard&quot;</span>: <span class="string">&quot;^7.1.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-friendly-formatter&quot;</span>: <span class="string">&quot;^2.0.7&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-html&quot;</span>: <span class="string">&quot;^2.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-promise&quot;</span>: <span class="string">&quot;^3.5.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-standard&quot;</span>: <span class="string">&quot;^2.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;wepy-eslint&quot;</span>: <span class="string">&quot;^1.5.3&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来操作主要是删除模板里的代码，然后把项目的结构和代码搬过去。</p>
<h2 id="wpy-文件代码结构调整"><a href="#wpy-文件代码结构调整" class="headerlink" title="wpy 文件代码结构调整"></a>wpy 文件代码结构调整</h2><p><code>WePy</code> 单文件组件主要由 <code>&lt;script&gt;</code>、<code>&lt;template&gt;</code>、<code>&lt;style&gt;</code>、<code>&lt;config&gt;</code> 四部分组成（也包括小程序 <code>&lt;wxs&gt;</code> 标签）。所以需要把 <code>WePY 1.7.2</code> 中定义在 <code>&lt;script&gt;</code> 中的 <code>config</code> 配置需要独立到外层的 <code>&lt;config&gt;</code> 中。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span></span><br><span class="line">    config = &#123;</span><br><span class="line"><span class="javascript">      navigationBarTitleText: <span class="string">&#x27;首页&#x27;</span>,</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span> &#123; navigationBarTitleText: &#x27;首页&#x27; &#125; <span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="程序-页面-组件注册方式调整"><a href="#程序-页面-组件注册方式调整" class="headerlink" title="程序/页面/组件注册方式调整"></a>程序/页面/组件注册方式调整</h2><p>注册方式将不再使用继承的方式，而是改成直接调用对应的实例方法。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">APP</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">app</span> </span>&#123;&#125;  <span class="comment">// 注册程序</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;&#125;  <span class="comment">// 注册页面</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">LIST</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">component</span> </span>&#123;&#125;  <span class="comment">// 注册组件</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wepy.app(&#123;&#125;) <span class="comment">// 注册程序</span></span><br><span class="line">wepy.page(&#123;&#125;) <span class="comment">// 注册页面</span></span><br><span class="line">wepy.component(&#123;&#125;) <span class="comment">// 注册组件</span></span><br></pre></td></tr></table></figure>

<h2 id="代码结构由类结构变成对象结构"><a href="#代码结构由类结构变成对象结构" class="headerlink" title="代码结构由类结构变成对象结构"></a>代码结构由类结构变成对象结构</h2><p>由于注册方式的改变，那么自然的代码结构也要有所调整。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span><br><span class="line">  data = &#123;&#125;</span><br><span class="line">  methods = &#123;&#125;</span><br><span class="line">  onLoad() &#123;&#125;</span><br><span class="line">  onShow() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wepy.page(&#123;</span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  onLoad() &#123;&#125;,</span><br><span class="line">  onShow() &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面仅仅只是以页面做为例子，<code>wepy.app()</code> 和 <code>wepy.component()</code> 也要对应调整。</p>
<h2 id="自定义方法和组件事件处理函数需要移到-methods-里"><a href="#自定义方法和组件事件处理函数需要移到-methods-里" class="headerlink" title="自定义方法和组件事件处理函数需要移到 methods 里"></a>自定义方法和组件事件处理函数需要移到 methods 里</h2><p>在 <code>WePY 1.7.2</code> 中注册的页面或者组件函数有这么几种类型：</p>
<ul>
<li>生命周期函数，比如 <code>onLoad</code>、<code>onShow</code> 等；</li>
<li><code>wxml</code> 事件处理函数，即在 <code>wxml</code> 中绑定的事件，这类函数需要定义在 <code>methods</code>，比如：<code>bindtap</code>、<code>bindchange</code> 等；</li>
<li>组件间事件处理函数，响应组件之间通过 <code>$broadcast</code>、<code>$emit</code>、<code>$invoke</code> 所传递的事件函数，这类函数需要定义在 <code>events</code> 对象里；</li>
<li>自定义函数，即用于被其他函数直接调用的函数，需要定义在和 <code>methods</code> 同级的位置。</li>
</ul>
<p>而在 <code>WePY 2</code> 中需要将组件处理函数和自定义函数都放到 <code>methods</code> 里。下面假设 <code>HOME</code> 页面有一个子组件 <code>child</code>，且子组件里会执行这句 <code>this.$emit(&#39;updateList)</code>，基于这个背景看下 <code>2</code> 个版本下的写法差异：</p>
<p><code>1.7.2</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;tapBox&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line"><span class="javascript">    onLoad() &#123;&#125; <span class="comment">// 生命周期函数</span></span></span><br><span class="line"><span class="javascript">    onShow() &#123;&#125; <span class="comment">// 生命周期函数</span></span></span><br><span class="line">    events = &#123;</span><br><span class="line"><span class="javascript">      updateList: <span class="function">() =&gt;</span> &#123;&#125;, <span class="comment">// 组件间事件处理函数</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    methods = &#123;</span><br><span class="line">      tapBox() &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// wxml事件处理函数</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.getMsg()</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    getMsg() &#123;&#125; <span class="comment">// 自定义函数</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> @<span class="attr">tap</span>=<span class="string">&quot;tapBox&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  wepy.page(&#123;</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line"><span class="javascript">    onLoad() &#123;&#125;, <span class="comment">// 生命周期函数</span></span></span><br><span class="line"><span class="javascript">    onShow() &#123;&#125;, <span class="comment">// 生命周期函数</span></span></span><br><span class="line">    methods: &#123;</span><br><span class="line">      tapBox() &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// wxml事件处理函数</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.getMsg()</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      updateList() &#123;&#125;, <span class="comment">// 组件间事件处理函数</span></span></span><br><span class="line"><span class="javascript">      getMsg() &#123;&#125;, <span class="comment">// 自定义函数</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="组件引入方式变更"><a href="#组件引入方式变更" class="headerlink" title="组件引入方式变更"></a>组件引入方式变更</h2><p>在 <code>2.x</code> 版本中组件引入不再通过 <code>import</code> 进行导入，而是直接定义在页面的配置 <code>&lt;config&gt;</code> 中。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&#x27;./components/child.wpy&#x27;</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span></span><br><span class="line">    components = &#123;</span><br><span class="line">      child: Child,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  wepy.page(&#123;&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span> &#123; usingComponents: &#123; &#x27;child&#x27;: &#x27;./components/child.wpy&#x27;, &#125; &#125; <span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>另外，<code>2.x</code> 中已经再不支持在 <code>app.wpy</code> 里定义全局组件，而 <code>1.7.2</code> 中是可以的。</p>
<h2 id="生命周期函数调整"><a href="#生命周期函数调整" class="headerlink" title="生命周期函数调整"></a>生命周期函数调整</h2><p>在 <code>2.x</code> 中生命周期函数基本和原生保持一致，和 <code>1.7.2</code> 相比，只是需要把组件中的 <code>onLoad</code> 改成了 <code>ready</code> 即可，其他无需变动。</p>
<table>
<thead>
<tr>
<th align="center">级别</th>
<th align="center">1.7.2</th>
<th align="center">2.x</th>
</tr>
</thead>
<tbody><tr>
<td align="center">app</td>
<td align="center">onLaunch</td>
<td align="center">onLaunch</td>
</tr>
<tr>
<td align="center">app</td>
<td align="center">onShow</td>
<td align="center">onShow</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">onLoad</td>
<td align="center">onLoad</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">onShow</td>
<td align="center">onShow</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">onReady</td>
<td align="center">onReady</td>
</tr>
<tr>
<td align="center">component</td>
<td align="center">-</td>
<td align="center">created</td>
</tr>
<tr>
<td align="center">component</td>
<td align="center">-</td>
<td align="center">attached</td>
</tr>
<tr>
<td align="center">component</td>
<td align="center">onLoad</td>
<td align="center">ready</td>
</tr>
</tbody></table>
<p><code>2.x</code> 生命周期执行顺序：</p>
<p><code>app onLaunch</code> -&gt; <code>app onShow</code> -&gt; <code>component created</code> -&gt; <code>component attached</code> -&gt; <code>page onLoad</code> -&gt; <code>page onShow</code> -&gt; <code>component ready</code> -&gt; <code>page onReady</code> -&gt; <code>page onUnload</code> -&gt; <code>component detached</code></p>
<blockquote>
<p><code>page onHide</code> 在当前页面通过 <code>wx.navigateTo</code> 打开新页面的时候会执行，而如果是在当前页面点击返回上一个页面或者 <code>wx.redirectTo</code> 并不会执行。</p>
</blockquote>
<h2 id="不再支持请求拦截器（坑）"><a href="#不再支持请求拦截器（坑）" class="headerlink" title="不再支持请求拦截器（坑）"></a>不再支持请求拦截器（坑）</h2><p>在 <code>1.7.2</code> 中可以在 <code>wepy.app</code> 的构造函数里通过配置拦截器可以对请求进行拦截，请求被拦截后可以加上更多的请求参数以及请求响应后可以进行统一的错误处理，功能还是挺好用的。但是在 <code>2.x</code> 中这个功能至少从文档上是没看到，虽然源码里提供了一个 <a target="_blank" rel="noopener" href="https://github.com/Tencent/wepy/tree/master/packages/use-intercept">use-intercept</a>拦截器的包，但是经过我几番尝试之后还是报错，所以就打算弃用拦截器了，直接在请求里进行参数增加和错误处理。<br><code>request.js</code> 这里贴一份大概的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wepy <span class="keyword">from</span> <span class="string">&#x27;@wepy/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HOST &#125; <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">url, data, handler = toast, header = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 头参数添加</span></span><br><span class="line">  header[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  header[<span class="string">&#x27;cType&#x27;</span>] = <span class="string">&#x27;WECHAT&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> wepy.wx</span><br><span class="line">    .request(&#123;</span><br><span class="line">      <span class="comment">// 这里 wepy.wx.request 这种写法，需要在app.wpy里配置promisify，</span></span><br><span class="line">      method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      data: data || &#123;&#125;,</span><br><span class="line">      header,</span><br><span class="line">      url: <span class="string">`<span class="subst">$&#123;HOST&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 请求成功处理代码放这儿</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 错误处理代码放这儿</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 <code>wepy.wx.request</code> 这种写法需要在 <code>app.wpy</code> 里配置 <code>promisify</code>，可以参考这里 <a target="_blank" rel="noopener" href="https://github.com/Tencent/wepy/tree/master/packages/use-promisify">use-promisify</a></p>
<h2 id="标签属性的值必须被双引号包裹"><a href="#标签属性的值必须被双引号包裹" class="headerlink" title="标签属性的值必须被双引号包裹"></a>标签属性的值必须被双引号包裹</h2><p>在 <code>1.7.2</code> 中对单引号和双引号没有强制要求，但是在 <code>2.x</code> 中必须是双引号，不然编译会报错。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;change&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view&gt;</span><br><span class="line">       &lt;view class&#x3D;&quot;title&quot; bindtap&#x3D;&quot;change&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="调用原生事件需要传入参数-wx"><a href="#调用原生事件需要传入参数-wx" class="headerlink" title="调用原生事件需要传入参数$wx"></a>调用原生事件需要传入参数$wx</h2><p>小程序原生事件会传递一个 event 参数。而 <code>WePY</code> 的事件分发器在处理事件时会有一个 <code>$event</code> 参数。 <code>$event</code> 参数是对 <code>event</code> 进行了一层包装，目地是为了无侵入地对齐 <code>Web Event</code> 标准属性。而其中 <code>$event.$wx === event</code>。 因此，<code>WePY</code> 中响应事件获得的事件参数均是指 <code>$event</code>。如果想拿到原生事件参数，请使用 <code>$event.$wx</code>。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">bindinput</span>=<span class="string">&quot;setInput&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;name&#125;&#125;&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span></span><br><span class="line">    data = &#123;</span><br><span class="line"><span class="javascript">      name: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">    &#125;</span><br><span class="line">    methods = &#123;</span><br><span class="line">      setInput(e) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.name = e.detail.value</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法，只需要将 <code>bindinput=&quot;setInput&quot;</code> 改成 <code>@input=&quot;setInput($wx)&quot;</code> 即可。</p>
<h2 id="模板语法修改"><a href="#模板语法修改" class="headerlink" title="模板语法修改"></a>模板语法修改</h2><p><code>2.x</code> 的模板语法继承了 <code>WXML</code> 的基本模板语法，并支持大部分 <code>Vue</code> 模板语法。<br>对于标签：<code>2.x</code> 支持绝大部分的 <code>HTML</code> 标签，经过编译后会转成标准的 <code>WXML</code> 模板语法。但是对于 <code>1.7.2</code> 中的有一个标签 <code>&lt;repeat&gt;</code> 不再支持，需要将其替换成 <code>&lt;view&gt;</code> 并且用 <code>v-for</code> 进行循环渲染。</p>
<p>下面是一些常用的模板语法对于 <code>2</code> 个版本之间写法的对比：<br><code>1.7.2</code> 写法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 属性绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">id</span>=<span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 数据绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 事件绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;change(&#123;&#123; index &#125;&#125;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- class绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;change &#123;&#123;hasData ? &#x27;has-data&#x27; : &#x27;&#x27; &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- style绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;&#123;&#123; &#x27;color:&#x27; + color + &#x27;;&#x27; + &#x27;font-size:&#x27; + fontSize + &#x27;;&#x27; &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 条件判断 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123; flag1 &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:elif</span>=<span class="string">&quot;&#123;&#123; flag2 &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 显示判断 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">hidden</span>=<span class="string">&quot;&#123;&#123; !isShow &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 列表渲染，默认是：item、index --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123; array &#125;&#125;&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;idx&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;itemName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 属性绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 数据绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 事件绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> @<span class="attr">tap</span>=<span class="string">&quot;change( index )&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- class绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;change&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;has-data&#x27;: hasData &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- style绑定 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;color&#x27;: color, &#x27;font-size&#x27;: fontSize &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 条件判断 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;flag1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else-if</span>=<span class="string">&quot;flag2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 显示判断 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 列表渲染，默认是：item、index --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in array&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于 <code>v-for</code> 循环列表的时候这里有一个（坑）不得不提一下，<a target="_blank" rel="noopener" href="https://github.com/Tencent/wepy/issues/2673#issue-673257402">github issues</a>直接看下面的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;item in array&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123; index &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> @<span class="attr">tap</span>=<span class="string">&quot;tapItem(index)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于上面的代码，<code>&lt;view&gt;&#123;&#123; index &#125;&#125;&lt;/view&gt;</code> 可以正常显示索引值 <code>index</code>，但是 <code>tapItem</code> 传的参数却是 <code>undefined</code>，这所以我们需要显示的声明索引 <code>v-for=&quot;(item, index) in array&quot;</code> 即可。</p>
<h2 id="表单双向绑定调整"><a href="#表单双向绑定调整" class="headerlink" title="表单双向绑定调整"></a>表单双向绑定调整</h2><p><code>2.x</code> 中直接用 <code>v-model</code> 进行表单绑定，而不需要再定义一个函数对其进行赋值操作。<br><code>1.7.2</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; name &#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;setInput&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span></span><br><span class="line">    data = &#123;</span><br><span class="line"><span class="javascript">        name: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">    &#125;</span><br><span class="line">    methods = &#123;</span><br><span class="line">        bindtap(e) &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">this</span>.name = e.detail.value</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">wepy.page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">        name: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="全局数据属性获取方式调整"><a href="#全局数据属性获取方式调整" class="headerlink" title="全局数据属性获取方式调整"></a>全局数据属性获取方式调整</h2><p>我们有时候需要在 <code>app.wpy</code> 里定义全局数据属性 <code>globalData</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">APP</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">app</span> </span>&#123;</span><br><span class="line">  globalData = &#123;</span><br><span class="line">    isBack: <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>2.x</code> 中定义方式没变，但是获取方式有所调整：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.7.2 获取方式</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.$parent.globalData.isBack)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.x 获取方式</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.$app.$options.globalData.isBack)</span><br></pre></td></tr></table></figure>

<h2 id="全局样式对组件无效"><a href="#全局样式对组件无效" class="headerlink" title="全局样式对组件无效"></a>全局样式对组件无效</h2><p><code>2.x</code> 中对组件的实现方式保留了很多原生小程序的特性，比如这一条，<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html">组件样式</a> 中明确说明：除继承样式外， <code>app.wxss</code> 中的样式、组件所在页面的的样式对自定义组件无效（除非更改组件样式隔离选项），虽然可以通过更改组件样式隔离选项使得组件可以被全局样式作用到，但有时候也会带来弊端，比如在标签的属性 <code>class</code> 前面加上 <code>~</code>，可以使组件获取全局样式，但是这样一来也带来一个问题，就是定义在组件里的该 <code>class</code> 样式会失效 😭。这样的升级真的让写样式很难受，所以为了让样式写得尽量方便简单，我还是老老实实的把组件的样式就定义在组件里，不从全局拿样式了。</p>
<h2 id="组件通信不再支持-broadcast"><a href="#组件通信不再支持-broadcast" class="headerlink" title="组件通信不再支持$broadcast"></a>组件通信不再支持$broadcast</h2><p>父组件给子组件传递数据可以通过设置静态或者动态的 <code>prop</code> 属性或者通过广播 <code>$broadcast</code> 来让所有子组件都收到父组件的信息，而子组件给父组件通信可以通过在父级自定义事件，在子组件中通过 <code>$emit</code> 来通信。但是在 <code>2.x</code> 中不再支持父级给子组件进行事件广播了，而是可以通过给子组件加上 <code>ref</code> 属性后，通过 <code>this.$refs</code> 来直接操作子组件函数来达成通信的目的，如下代码：<br><code>parent.wpy</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span> <span class="attr">ref</span>=<span class="string">&quot;child&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  wepy.page(&#123;</span><br><span class="line">    onLoad() &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.$refs.child.getList()</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>child.wpy</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">wepy.component(&#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">        getList() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="组件-prop-不再支持双向绑定"><a href="#组件-prop-不再支持双向绑定" class="headerlink" title="组件 prop 不再支持双向绑定"></a>组件 prop 不再支持双向绑定</h2><p>在 <code>1.7.2</code> 中可以通过可以通过设置 <code>prop</code> 给子组件传参，如果设置的时候加上 <code>.sync</code> 那么当父组件参数更新的时候，传递给子组件的也会自动更新，而如果在子组件的 <code>prop</code> 里加上 <code>twoWay: true</code> 则子组件数据可以绑定到父组件。从而实现组件数据的双向绑定。功能还是挺好用的，但遗憾的是在 <code>2.x</code> 中已经不再支持通过 <code>twoWay: true</code> 的方式从子组件绑定数据到父组件，父到子是可以的，但是不再需要设置 <code>sync</code>。那子组件需要更新父组件的数据，只能通过自定义事件，然后在子组件通过 <code>$emit</code> 进行更新数据了。<br><code>1.7.2</code> 写法：<br>父页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">:title.sync</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tempalte</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export default class CHILD extends wepy.component &#123; props = &#123; title: &#123; type:</span><br><span class="line">String, default: &#x27;&#x27;, twoWay: true &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p><code>2.x</code> 写法：<br>父页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">:title</span>=<span class="string">&quot;title&quot;</span> @<span class="attr">changeTitle</span>=<span class="string">&quot;changeTitle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tempalte</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HOME</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span></span><br><span class="line">        data = &#123;</span><br><span class="line"><span class="javascript">            title: <span class="string">&#x27;最开始的标题&#x27;</span>,</span></span><br><span class="line">        &#125;</span><br><span class="line">        events = &#123;</span><br><span class="line">            changeTitle(val) &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.title = val</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wepy.page(&#123; props: &#123; title: &#123; type: String, default: &#x27;&#x27;, &#125; &#125;, onLoad()&#123;</span><br><span class="line">this.$emit(&#x27;changeTitle&#x27;, &#x27;改变之后的标题&#x27;) &#125; &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="组件插槽-slot-代码插入后层级错乱问题（坑）"><a href="#组件插槽-slot-代码插入后层级错乱问题（坑）" class="headerlink" title="组件插槽 slot 代码插入后层级错乱问题（坑）"></a>组件插槽 slot 代码插入后层级错乱问题（坑）</h2><p>这个问题已经提到 <a target="_blank" rel="noopener" href="https://github.com/Tencent/wepy/issues/2649#issue-655560396">github issues</a> 中，且已经被作者标记为 <code>bug</code>。<br>原始代码：<br><code>parent.wpy</code> 父页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>child view<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>child.wpy</code> 子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>child<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>期望的编译后（正确）的 <code>template</code> 是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>child<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>child view<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而实际 <code>2.x</code> 编译后的 <code>template</code> 是会将对应的内容插入到子组件与根元素并列那级：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>child<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span>child view<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>针对老项目里用到 <code>slot</code> 的地方，我只能改写代码来避开这个坑了。</p>
<h2 id="资源引入调整"><a href="#资源引入调整" class="headerlink" title="资源引入调整"></a>资源引入调整</h2><p>资源引入方式调整主要是介绍组件引入和图片引入两种。首先来看组件引入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;config&gt;</span><br><span class="line">&#123;</span><br><span class="line">  usingComponents: &#123;</span><br><span class="line">    <span class="string">&#x27;load-more&#x27;</span>: <span class="string">&#x27;/components/loadMore&#x27;</span>,  <span class="comment">// 绝对路径</span></span><br><span class="line">    <span class="string">&#x27;btn&#x27;</span>: <span class="string">&#x27;../btn&#x27;</span>,  <span class="comment">// 相对路径</span></span><br><span class="line">    <span class="string">&#x27;list&#x27;</span>: <span class="string">&#x27;~@/components/list&#x27;</span>,  <span class="comment">// 通过wepy.config.js配置别名@指向src，实际上也是绝对路径</span></span><br><span class="line">    <span class="string">&#x27;van-icon&#x27;</span>: <span class="string">&#x27;module:van-icon&#x27;</span>,  <span class="comment">// 模块引入</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>对于图片引入，存在两种方式：一种是静态的，程序在编译的时候就知道需要把哪些图片加载出来，另一种是动态的，只有在程序执行的时候才知道要加载哪些图片。对于第一种方式，通过相对路径、绝对路径或者 <code>@</code> 都可以引入到图片：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../bg.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/images/icon.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;@/images/nodata.png&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于第二种方式，需要将动态的图片放置在某个固定的位置，比如 <code>/src/images/static</code>，然后再 <code>wepy.config.js</code> 里配置 <code>static: [&#39;/src/images/static&#39;]</code> 这样在编译的时候就会把这个路径下的文件都拷贝到输出后的目录，从而能够准确引用这些动态图片。<br><code>wepy.config.js</code> 配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="keyword">static</span>: [<span class="string">&#x27;src/images/static&#x27;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;&#x27;../images/static/&#x27; + fileType + &#x27;.png&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;imgSrc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  wepy.page(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      imgSrc: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onLoad() &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.imgSrc = <span class="string">&#x27;/images/static/icon.png&#x27;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>静态图片特殊处理：单独放到一个目录里，然后再 WePY.config.js 里配置 static</p>
<h2 id="scss-里如果引入-wxss-文件会直接终止编译进程"><a href="#scss-里如果引入-wxss-文件会直接终止编译进程" class="headerlink" title="scss 里如果引入.wxss 文件会直接终止编译进程"></a>scss 里如果引入.wxss 文件会直接终止编译进程</h2><p>下面的代码是一个页面的 <code>scss</code> 样式里，引入了 <code>wxss</code> 文件，最终会导致编译进程终止。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; type=&quot;text/scss&quot;&gt;</span><br><span class="line">    <span class="keyword">@import</span> <span class="string">&quot;./btn.scss&quot;</span>;</span><br><span class="line">    <span class="keyword">@import</span> <span class="string">&quot;./styles/common.wxss&quot;</span>;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>解决办法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; type=&quot;text/scss&quot;&gt;</span><br><span class="line">    <span class="keyword">@import</span> <span class="string">&quot;./btn.scss&quot;</span>;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;style lang=&quot;wxss&quot; type=&quot;text/wxss&quot;&gt;</span><br><span class="line">    <span class="keyword">@import</span> <span class="string">&quot;./styles/common.wxss&quot;</span>;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="scss-样式里存在特殊字符会导致编译报错（坑）"><a href="#scss-样式里存在特殊字符会导致编译报错（坑）" class="headerlink" title="scss 样式里存在特殊字符会导致编译报错（坑）"></a>scss 样式里存在特殊字符会导致编译报错（坑）</h2><p>这里的特殊字符其实也是正常的需求，比如引入了字体图标，那可能会有这种样式 <code>content: &#39;\6499&#39;</code>, 然后因为有反斜杠会直接导致报错编译错误。解决思路是把这种带有特殊字符的样式放到 <code>wxss</code> 里，然后通过另外一个 <code>style</code> 引入进来，编译器进行编译的时候会对 <code>scss</code> 样式进行编译处理，但是对于 <code>wxss</code> 会直接拷贝到输入目录，而不进行编译处理，所以能绕过这个坑。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; type=&quot;text/scss&quot;&gt;</span><br><span class="line">    <span class="keyword">@import</span> <span class="string">&quot;./btn.scss&quot;</span>;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;style lang=&quot;wxss&quot; type=&quot;text/wxss&quot;&gt;</span><br><span class="line">    <span class="selector-class">.icon-success</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">&#x27;\e8921&#x27;</span>;</span><br><span class="line">        <span class="attribute">color</span>: green;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="数据绑定机制调整"><a href="#数据绑定机制调整" class="headerlink" title="数据绑定机制调整"></a>数据绑定机制调整</h2><p><code>1.7.2</code> 中用脏检查进行数据绑定，通过 <code>$apply()</code> 方法使得数据能够及时更新，页面重新渲染。在 <code>2.x</code> 中使用了 <code>Vue Observer</code> 实现数据绑定，告别 <code>$apply()</code>，但是遇到一个问题，某个数组项的某个属性更新后，数组虽然是更新了，但是不能够触发页面进行重新渲染，即使使用 <code>splice</code> 也不行。不过可以通过浅拷贝一个引用类型，重新赋值，从而触发页面重新渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">wepy.page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    list: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">        hasBorder: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">&#x27;bbb&#x27;</span>,</span><br><span class="line">        hasBorder: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick() &#123;</span><br><span class="line">      <span class="built_in">this</span>.list[<span class="number">1</span>].hasBorder = <span class="literal">true</span> <span class="comment">// 不会重新渲染页面</span></span><br><span class="line">      <span class="built_in">this</span>.list.splice(<span class="number">1</span>, <span class="number">1</span>, &#123;</span><br><span class="line">        <span class="comment">// 也不会重新渲染页面</span></span><br><span class="line">        name: <span class="string">&#x27;bbb&#x27;</span>,</span><br><span class="line">        hasBorder: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">this</span>.list = [...this.list] <span class="comment">// 浅拷贝，使得this.list的引用地址变化了，使得页面重新渲染</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2020/09/21/vue-operate/" title="34条我能告诉你的Vue之实操篇" class="prev">上一篇</a><a href="/2020/07/29/js-datatype/" title="JavaScript中的数据类型" class="next">下一篇</a></div><a href="#comment" class="comment-anchor"></a><div id="vcomments"></div><script>new Valine({
    el: "#vcomments",
    appId: "aD8jJBpu4oew3ovNY73z6Rdq-gzGzoHsz",
    appKey: "FdzS5SOPHdhYQoEUngQ8K2QW",
    notify: false,
    verify: false,
    avatar: "robohash",
    visitor: true,
    placeholder: "随便说点什么～.～",
});</script><div class="copyright"><p>© 2016 - 2024 <a href="https://weibo.com/316000381" target="_blank">typeR</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p><span id="busuanzi_container_site_pv">本站总访问数：<span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv" style="padding-left: 6px;">访客数：<span id="busuanzi_value_site_uv"></span></span></p><p> <span style="padding-right: 6px;">闽ICP备16007301号-2</span></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/jquery-1.8.2.min.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/articleCatalog.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>