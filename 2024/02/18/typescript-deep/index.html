<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> 深入学习 TypeScript 类型体操 · 步步走</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="深入学习 TypeScript 类型体操"><meta name="keywords" content="TypeScript、类型体操"><meta name="author" content="typeR"><link rel="short icon" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/favicon.ico"><link rel="stylesheet" href="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://bubuzou.com/atom.xml" title="步步走"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/atom.xml" title="步步走" type="application/atom+xml">
</head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/logo.svg"></a><ul id="nav_list" class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div><div id="nav_btn" class="nav-btn"><span></span><span></span><span></span></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">深入学习 TypeScript 类型体操</h1><div class="post-info">2024-02-18<p id="busuanzi_container_page_pv" class="visit"><span id="busuanzi_value_page_pv"> </span><span>次访问</span></p></div><div class="post-content"><h2 id="模式匹配做提取"><a href="#模式匹配做提取" class="headerlink" title="模式匹配做提取"></a>模式匹配做提取</h2><h3 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h3><p><strong>提取数组第一个元素的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetFirst&lt;Arr <span class="keyword">extends</span> unknown[]&gt; = Arr <span class="keyword">extends</span> [infer First, ...unknown[]]</span><br><span class="line">  ? First</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>提取数组最后一个元素的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetLast&lt;Arr <span class="keyword">extends</span> unknown[]&gt; = Arr <span class="keyword">extends</span> [...unknown[], infer Last]</span><br><span class="line">  ? Last</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>取去掉最后一个元素的数组</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PopArr&lt;Arr <span class="keyword">extends</span> unknown[]&gt; = Arr <span class="keyword">extends</span> []</span><br><span class="line">  ? []</span><br><span class="line">  : Arr <span class="keyword">extends</span> [...infer Rest, unknown]</span><br><span class="line">  ? Rest</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><p><strong>字符串是否以某个特定字符开头</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StartWidth&lt;</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  Prefix <span class="keyword">extends</span> <span class="built_in">String</span></span><br><span class="line">&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;Prefix&#125;</span><span class="subst">$&#123;<span class="built_in">string</span>&#125;</span>`</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p><strong>将字符串中某个特定的部分替换成别的字符串</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReplaceStr&lt;</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  From <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  To <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Prefix&#125;</span><span class="subst">$&#123;From&#125;</span><span class="subst">$&#123;infer Suffix&#125;</span>`</span></span><br><span class="line">  ? <span class="string">`<span class="subst">$&#123;Prefix&#125;</span><span class="subst">$&#123;To&#125;</span><span class="subst">$&#123;Suffix&#125;</span>`</span></span><br><span class="line">  : Str;</span><br></pre></td></tr></table></figure>

<p><strong>字符串去除右空格</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TrimStrRight&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Rest&#125;</span><span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">  | <span class="string">&quot; &quot;</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  | <span class="string">&quot;\n&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  | <span class="string">&quot;\t&quot;</span>&#125;</span>`</span></span><br><span class="line">  ? TrimStrRight&lt;Rest&gt;</span><br><span class="line">  : Str;</span><br></pre></td></tr></table></figure>

<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><p><strong>提取函数参数的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetParameters&lt;Func <span class="keyword">extends</span> <span class="built_in">Function</span>&gt; = Func <span class="keyword">extends</span> (</span><br><span class="line">  ...args: infer Args</span><br><span class="line">) =&gt; unknown</span><br><span class="line">  ? Args</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>提取函数返回值的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetReturnType&lt;Func <span class="keyword">extends</span> <span class="built_in">Function</span>&gt; = Func <span class="keyword">extends</span> (</span><br><span class="line">  ...args: <span class="built_in">any</span>[]</span><br><span class="line">) =&gt; infer ReturnType</span><br><span class="line">  ? ReturnType</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h3><p><strong>提取构造器参数的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetInstanceParameters&lt;ConstructorType <span class="keyword">extends</span> <span class="keyword">new</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; =</span><br><span class="line">  ConstructorType <span class="keyword">extends</span> <span class="keyword">new</span> (...args: infer ParametersType) =&gt; <span class="built_in">any</span></span><br><span class="line">    ? ParametersType</span><br><span class="line">    : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>提取构造器返回值类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetInstanceReturnType&lt;ConstructorType <span class="keyword">extends</span> <span class="keyword">new</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; =</span><br><span class="line">  ConstructorType <span class="keyword">extends</span> <span class="keyword">new</span> (...args: <span class="built_in">any</span>) =&gt; infer InstanceType</span><br><span class="line">    ? InstanceType</span><br><span class="line">    : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h3><p><strong>提取 props 中 ref 值的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetRefProps&lt;Props&gt; = <span class="string">&quot;ref&quot;</span> <span class="keyword">extends</span> keyof Props</span><br><span class="line">  ? Props <span class="keyword">extends</span> &#123; ref?: infer Value | <span class="literal">undefined</span> &#125;</span><br><span class="line">    ? Value</span><br><span class="line">    : <span class="built_in">never</span></span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h2 id="重新构造做变换"><a href="#重新构造做变换" class="headerlink" title="重新构造做变换"></a>重新构造做变换</h2><p>TypeScript 的 type、infer、类型参数声明的变量都不能修改，想对类型做各种变换产生新的类型就需要重新构造。</p>
<h3 id="数组类型的构造"><a href="#数组类型的构造" class="headerlink" title="数组类型的构造"></a>数组类型的构造</h3><p><strong>给数组/元组添加新类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Push&lt;Arr <span class="keyword">extends</span> unknown[], Ele&gt; = [...Arr, Ele];</span><br></pre></td></tr></table></figure>

<p><strong>元组重组</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> tuple1 = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">type</span> tuple2 = [<span class="string">&quot;guang&quot;</span>, <span class="string">&quot;dong&quot;</span>];</span><br><span class="line"><span class="comment">// 重组成如下的元组</span></span><br><span class="line"><span class="keyword">type</span> tuple = [[<span class="number">1</span>, <span class="string">&quot;guang&quot;</span>], [<span class="number">2</span>, <span class="string">&quot;dong&quot;</span>]];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码实现</span></span><br><span class="line"><span class="keyword">type</span> Zip&lt;One <span class="keyword">extends</span> unknown[], Other <span class="keyword">extends</span> unknown[]&gt; = One <span class="keyword">extends</span> [</span><br><span class="line">  infer OneFirst,</span><br><span class="line">  ...infer OneRest</span><br><span class="line">]</span><br><span class="line">  ? Other <span class="keyword">extends</span> [infer OtherFirst, ...infer OtherRest]</span><br><span class="line">    ? [[OneFirst, OtherFirst], ...Zip&lt;OneRest, OtherRest&gt;]</span><br><span class="line">    : []</span><br><span class="line">  : [];</span><br></pre></td></tr></table></figure>

<h3 id="字符串类型的构造"><a href="#字符串类型的构造" class="headerlink" title="字符串类型的构造"></a>字符串类型的构造</h3><p><strong>将字符串首字母大写</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CapitalizeStr&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer First&#125;</span><span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">    ? <span class="string">`<span class="subst">$&#123;Uppercase&lt;First&gt;&#125;</span><span class="subst">$&#123;Rest&#125;</span>`</span></span><br><span class="line">    : Str;</span><br></pre></td></tr></table></figure>

<p><strong>将字符串下划线转驼峰</strong></p>
<dl><dt>```ts<code>type CamelCase&lt;Str extends string&gt; = Str extends</code>${infer Left}_${infer Right}${infer Rest}<code>?</code>${Left}${Uppercase<Right>}${CamelCase<Rest>}`</dt><dd>Str;</dd></dl><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**删除字符串子串**</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;ts</span><br><span class="line">type DropSubStr&lt;Str extends string, SubStr extends string&gt; &#x3D;</span><br><span class="line">    Str extends &#96;$&#123;infer Prefix&#125;$&#123;SubStr&#125;$&#123;infer Suffix&#125;&#96;</span><br><span class="line">        ? DropSubStr&lt;&#96;$&#123;Prefix&#125;$&#123;Suffix&#125;&#96;, SubStr&gt;</span><br><span class="line">        : Str;</span><br></pre></td></tr></table></figure>

<h3 id="函数类型的构造"><a href="#函数类型的构造" class="headerlink" title="函数类型的构造"></a>函数类型的构造</h3><p><strong>给函数添加一个参数</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AppendArgument&lt;Func <span class="keyword">extends</span> <span class="built_in">Function</span>, Arg&gt; = Func <span class="keyword">extends</span> (</span><br><span class="line">  ...args: infer Args</span><br><span class="line">) =&gt; infer ReturnType</span><br><span class="line">  ? <span class="function">(<span class="params">...args: [...Args, Arg]</span>) =&gt;</span> ReturnType</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="索引类型的构造"><a href="#索引类型的构造" class="headerlink" title="索引类型的构造"></a>索引类型的构造</h3><p>索引类型是聚合多个元素的类型。比如 class 和对象都是索引类型。索引类型的元素的类型只能是 string、number 或者 Symbol 等类型。</p>
<p>索引类型的每个元素的类型可以添加修饰符：readonly（只读）、?（可选）。</p>
<p><strong>映射类型语法</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Mapping&lt;Obj <span class="keyword">extends</span> <span class="built_in">object</span>&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>用 as 做重映射改变索引类型的 Key 转成大写</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UppercaseKey&lt;Obj <span class="keyword">extends</span> <span class="built_in">object</span>&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> Uppercase&lt;Key &amp; <span class="built_in">string</span>&gt;]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为这里索引的类型可能是 string、number 或 symbol 类型，但是这里转成大写只能是限定为 string。</p>
</blockquote>
<p><strong>TS 内置高级类型 Record</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Record&lt;K <span class="keyword">extends</span> <span class="built_in">string</span> | <span class="built_in">number</span> | symbol, T&gt; = &#123; [P <span class="keyword">in</span> K]: T &#125;;</span><br></pre></td></tr></table></figure>

<p><strong>UppercaseKey 重写版：用 Record 来约束索引类型而不是 object</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UppercaseKey&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> Uppercase&lt;Key &amp; <span class="built_in">string</span>&gt;]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>给索引类型添加只读的高级类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ToReadonly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [Key <span class="keyword">in</span> keyof T]: T[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>给索引类型添加可选的高级类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ToPartial&lt;T&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof T]?: T[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>给索引类型去掉只读修饰符</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ToMutable&lt;T&gt; = &#123;</span><br><span class="line">  -<span class="keyword">readonly</span> [Key <span class="keyword">in</span> keyof T]: T[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>给索引类型去掉可选修饰符</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ToRequired&lt;T&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof T]-?: T[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>返回特定值的类型的索引类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FilterByValueType&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;, ValueType&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> Obj[Key] <span class="keyword">extends</span> ValueType ? Key : <span class="built_in">never</span>]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="递归复用做循环"><a href="#递归复用做循环" class="headerlink" title="递归复用做循环"></a>递归复用做循环</h2><h3 id="Promise-的递归复用"><a href="#Promise-的递归复用" class="headerlink" title="Promise 的递归复用"></a>Promise 的递归复用</h3><p><strong>提取 Promise 值的类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DeepPromiseValueType&lt;P <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;unknown&gt;&gt; = P <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;</span><br><span class="line">  infer ValueType</span><br><span class="line">&gt;</span><br><span class="line">  ? ValueType <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;unknown&gt;</span><br><span class="line">    ? DeepPromiseValueType&lt;ValueType&gt;</span><br><span class="line">    : ValueType</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>提取 Promise 值的类型简化版</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DeepPromiseValueType&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;infer ValueType&gt;</span><br><span class="line">  ? DeepPromiseValueType&lt;ValueType&gt;</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="数组类型的递归"><a href="#数组类型的递归" class="headerlink" title="数组类型的递归"></a>数组类型的递归</h3><p><strong>反转元组</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReversrArr&lt;Arr <span class="keyword">extends</span> unknown[]&gt; = Arr <span class="keyword">extends</span> [</span><br><span class="line">  infer First,</span><br><span class="line">  ...infer Rest</span><br><span class="line">]</span><br><span class="line">  ? [...ReversrArr&lt;Rest&gt;, First]</span><br><span class="line">  : Arr;</span><br></pre></td></tr></table></figure>

<p><strong>查找元素</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Includes&lt;Arr <span class="keyword">extends</span> unknown[], FindItem&gt; = Arr <span class="keyword">extends</span> [</span><br><span class="line">  infer First,</span><br><span class="line">  ...infer Rest</span><br><span class="line">]</span><br><span class="line">  ? IsEqual&lt;First, FindItem&gt; <span class="keyword">extends</span> <span class="literal">true</span></span><br><span class="line">    ? <span class="literal">true</span></span><br><span class="line">    : Includes&lt;Rest, FindItem&gt;</span><br><span class="line">  : <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">type</span> IsEqual&lt;A, B&gt; = (A <span class="keyword">extends</span> B ? <span class="literal">true</span> : <span class="literal">false</span>) &amp;</span><br><span class="line">  (B <span class="keyword">extends</span> A ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><strong>删除元素</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RemoveItem&lt;</span><br><span class="line">  Arr <span class="keyword">extends</span> unknown[],</span><br><span class="line">  Item,</span><br><span class="line">  Result <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Arr <span class="keyword">extends</span> [infer First, ...infer Rest]</span><br><span class="line">  ? IsEqual&lt;First, Item&gt; <span class="keyword">extends</span> <span class="literal">true</span></span><br><span class="line">    ? RemoveItem&lt;Rest, Item, Result&gt;</span><br><span class="line">    : RemoveItem&lt;Rest, Item, [...Result, First]&gt;</span><br><span class="line">  : Result;</span><br><span class="line"><span class="keyword">type</span> IsEqual&lt;A, B&gt; = (A <span class="keyword">extends</span> B ? <span class="literal">true</span> : <span class="literal">false</span>) &amp;</span><br><span class="line">  (B <span class="keyword">extends</span> A ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p><strong>构造指定类型的数组</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BuildArray&lt;</span><br><span class="line">  Length <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  Ele = unknown,</span><br><span class="line">  Arr <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Arr[<span class="string">&quot;length&quot;</span>] <span class="keyword">extends</span> Length ? Arr : BuildArray&lt;Length, Ele, [...Arr, Ele]&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="字符串类型的递归"><a href="#字符串类型的递归" class="headerlink" title="字符串类型的递归"></a>字符串类型的递归</h3><p><strong>替换子串</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReplaceAll&lt;</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  From <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  To <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Left&#125;</span><span class="subst">$&#123;From&#125;</span><span class="subst">$&#123;infer Right&#125;</span>`</span></span><br><span class="line">  ? <span class="string">`<span class="subst">$&#123;Left&#125;</span><span class="subst">$&#123;To&#125;</span><span class="subst">$&#123;ReplaceAll&lt;Right, From, To&gt;&#125;</span>`</span></span><br><span class="line">  : Str;</span><br></pre></td></tr></table></figure>

<p><strong>提取字符做联合类型</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StringToUnion&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="string">`&#123;infer First&#125;<span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">    ? First | StringToUnion&lt;Rest&gt;</span><br><span class="line">    : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>反转字符串</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReverseStr&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer First&#125;</span><span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">  ? <span class="string">`<span class="subst">$&#123;ReverseStr&lt;Rest&gt;&#125;</span><span class="subst">$&#123;First&#125;</span>`</span></span><br><span class="line">  : Str;</span><br></pre></td></tr></table></figure>

<h3 id="对象类型的递归"><a href="#对象类型的递归" class="headerlink" title="对象类型的递归"></a>对象类型的递归</h3><p><strong>深度递归</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DeepToReadonly&lt;T <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = T <span class="keyword">extends</span> <span class="built_in">any</span></span><br><span class="line">  ? &#123;</span><br><span class="line">      <span class="keyword">readonly</span> [Key <span class="keyword">in</span> keyof T]: T[Key] <span class="keyword">extends</span> <span class="built_in">Object</span></span><br><span class="line">        ? T[Key] <span class="keyword">extends</span> <span class="built_in">Function</span></span><br><span class="line">          ? T[Key]</span><br><span class="line">          : DeepToReadonly&lt;T[Key]&gt;</span><br><span class="line">        : T[Key];</span><br><span class="line">    &#125;</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h2 id="数组长度做计算"><a href="#数组长度做计算" class="headerlink" title="数组长度做计算"></a>数组长度做计算</h2><h3 id="数组长度实现加减乘除"><a href="#数组长度实现加减乘除" class="headerlink" title="数组长度实现加减乘除"></a>数组长度实现加减乘除</h3><p><strong>加法</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BuildArray&lt;</span><br><span class="line">  Length <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  Ele = unknown,</span><br><span class="line">  Arr <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Arr[<span class="string">&quot;length&quot;</span>] <span class="keyword">extends</span> Length ? Arr : BuildArray&lt;Length, Ele, [...Arr, Ele]&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Add&lt;Num1 <span class="keyword">extends</span> <span class="built_in">number</span>, Num2 <span class="keyword">extends</span> <span class="built_in">number</span>&gt; = [</span><br><span class="line">  ...BuildArray&lt;Num1&gt;,</span><br><span class="line">  ...BuildArray&lt;Num2&gt;</span><br><span class="line">][<span class="string">&quot;length&quot;</span>];</span><br></pre></td></tr></table></figure>

<p><strong>减法</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Subtract&lt;</span><br><span class="line">  Num1 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  Num2 <span class="keyword">extends</span> <span class="built_in">number</span></span><br><span class="line">&gt; = BuildArray&lt;Num1&gt; <span class="keyword">extends</span> [...BuildArray&lt;Num2&gt;, ...infer Rest]</span><br><span class="line">  ? Rest[<span class="string">&quot;length&quot;</span>]</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p><strong>乘法</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Multiple&lt;</span><br><span class="line">  Num1 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  Num2 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  ResultArr <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Num2 <span class="keyword">extends</span> <span class="number">0</span></span><br><span class="line">  ? ResultArr[<span class="string">&quot;length&quot;</span>]</span><br><span class="line">  : Multiple&lt;Num1, Subtract&lt;Num2, <span class="number">1</span>&gt;, [...ResultArr, ...BuildArray&lt;Num1&gt;]&gt;;</span><br></pre></td></tr></table></figure>

<p><strong>除法</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Divide&lt;</span><br><span class="line">  Num1 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  Num2 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  ResultArr <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Num1 <span class="keyword">extends</span> <span class="number">0</span></span><br><span class="line">  ? ResultArr[<span class="string">&quot;length&quot;</span>]</span><br><span class="line">  : Divide&lt;Subtract&lt;Num1, Num2&gt;, Num2, [...ResultArr, unknown]&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="数组长度实现计数"><a href="#数组长度实现计数" class="headerlink" title="数组长度实现计数"></a>数组长度实现计数</h3><p><strong>计算字符串长度</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> StrLen&lt;</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  CountArr <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">string</span>&#125;</span><span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">  ? StrLen&lt;Rest, [...CountArr, unknown]&gt;</span><br><span class="line">  : CountArr[<span class="string">&quot;length&quot;</span>];</span><br></pre></td></tr></table></figure>

<p><strong>比较 2 个数值谁更大</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GreaterThan&lt;</span><br><span class="line">  Num1 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  Num2 <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  CountArr <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Num1 <span class="keyword">extends</span> Num2</span><br><span class="line">  ? <span class="literal">false</span></span><br><span class="line">  : CountArr[<span class="string">&quot;length&quot;</span>] <span class="keyword">extends</span> Num2</span><br><span class="line">  ? <span class="literal">true</span></span><br><span class="line">  : CountArr[<span class="string">&quot;length&quot;</span>] <span class="keyword">extends</span> Num1</span><br><span class="line">  ? <span class="literal">false</span></span><br><span class="line">  : GreaterThan&lt;Num1, Num2, [...CountArr, unknown]&gt;;</span><br></pre></td></tr></table></figure>

<p><strong>实现斐波那契数列</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FibonacciLoop&lt;</span><br><span class="line">  PrevArr <span class="keyword">extends</span> unknown[],</span><br><span class="line">  CurrentArr <span class="keyword">extends</span> unknown[],</span><br><span class="line">  IndexArr <span class="keyword">extends</span> unknown[] = [],</span><br><span class="line">  Num <span class="keyword">extends</span> <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">&gt; = IndexArr[<span class="string">&quot;length&quot;</span>] <span class="keyword">extends</span> Num</span><br><span class="line">  ? CurrentArr[<span class="string">&quot;length&quot;</span>]</span><br><span class="line">  : FibonacciLoop&lt;</span><br><span class="line">      CurrentArr,</span><br><span class="line">      [...PrevArr, ...CurrentArr],</span><br><span class="line">      [...IndexArr, unknown],</span><br><span class="line">      Num</span><br><span class="line">    &gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Fibonacci&lt;Num <span class="keyword">extends</span> <span class="built_in">number</span>&gt; = FibonacciLoop&lt;[<span class="number">1</span>], [], [], Num&gt;;</span><br></pre></td></tr></table></figure>

<h2 id="聚合分散可简化"><a href="#聚合分散可简化" class="headerlink" title="聚合分散可简化"></a>聚合分散可简化</h2><h3 id="分布式条件类型"><a href="#分布式条件类型" class="headerlink" title="分布式条件类型"></a>分布式条件类型</h3><p>当类型参数为联合类型，并且在条件类型左边直接引用该类型参数的时候，TypeScript 会把每一个元素单独传入来做类型运算，最后再合并成联合类型，这种语法叫做分布式条件类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Union = <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> UppercaseA&lt;Item <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = Item <span class="keyword">extends</span> <span class="string">&quot;a&quot;</span></span><br><span class="line">  ? Uppercase&lt;Item&gt;</span><br><span class="line">  : Item;</span><br></pre></td></tr></table></figure>

<p>这和联合类型遇到字符串时的处理一样：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Union = <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> str = <span class="string">`<span class="subst">$&#123;Union&#125;</span>~`</span>;</span><br><span class="line"><span class="comment">// type str = &#x27;a~&#x27; | &#x27;b~&#x27;;</span></span><br></pre></td></tr></table></figure>

<h3 id="数组转联合类型"><a href="#数组转联合类型" class="headerlink" title="数组转联合类型"></a>数组转联合类型</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Arr = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>];</span><br><span class="line"><span class="keyword">type</span> UnionArr = Arr[<span class="built_in">number</span>];</span><br><span class="line"><span class="comment">// type UnionArr = &#x27;a&#x27; | &#x27;b&#x27; | &#x27;c&#x27;;</span></span><br></pre></td></tr></table></figure>

<h3 id="判断是否是联合类型"><a href="#判断是否是联合类型" class="headerlink" title="判断是否是联合类型"></a>判断是否是联合类型</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> isUnion&lt;A, B = A&gt; = A <span class="keyword">extends</span> A ? ([B] <span class="keyword">extends</span> [A] ? <span class="literal">false</span> : <span class="literal">true</span>) : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<p>当 A 是联合类型时：</p>
<ul>
<li>A extends A 这种写法是为了触发分布式条件类型，让每个类型单独传入处理的，没别的意义。</li>
<li>A extends A 和 [A] extends [A] 是不同的处理，前者是单个类型和整个类型做判断，后者两边都是整个联合类型，因为只有 extends 左边直接是类型参数才会触发分布式条件类型。</li>
</ul>
<h3 id="BEM"><a href="#BEM" class="headerlink" title="BEM"></a>BEM</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BEM&lt;</span><br><span class="line">  Block <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  Element <span class="keyword">extends</span> <span class="built_in">string</span>[],</span><br><span class="line">  Modifiers <span class="keyword">extends</span> <span class="built_in">string</span>[]</span><br><span class="line">&gt; = <span class="string">`<span class="subst">$&#123;Block&#125;</span>__<span class="subst">$&#123;Element[<span class="built_in">number</span>]&#125;</span>--<span class="subst">$&#123;Modifiers[<span class="built_in">number</span>]&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="全组合"><a href="#全组合" class="headerlink" title="全组合"></a>全组合</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A 和 B 的全组合</span></span><br><span class="line"><span class="keyword">type</span> Combination&lt;A <span class="keyword">extends</span> <span class="built_in">string</span>, B <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">    A | B | <span class="string">`<span class="subst">$&#123;A&#125;</span><span class="subst">$&#123;B&#125;</span>`</span> | <span class="string">`<span class="subst">$&#123;B&#125;</span><span class="subst">$&#123;A&#125;</span>`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全组合</span></span><br><span class="line"><span class="keyword">type</span> AllCombinations&lt;A <span class="keyword">extends</span> <span class="built_in">string</span>, B <span class="keyword">extends</span> <span class="built_in">string</span> = A&gt; =</span><br><span class="line">    A extens A</span><br><span class="line">        ? Combination&lt;A, AllCombinations&lt;Exclude&lt;B, A&gt;&gt;&gt;</span><br><span class="line">        : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h2 id="特殊特性要记清"><a href="#特殊特性要记清" class="headerlink" title="特殊特性要记清"></a>特殊特性要记清</h2><h3 id="IsAny"><a href="#IsAny" class="headerlink" title="IsAny"></a>IsAny</h3><p>any 类型与任何类型的交叉都是 any，也就是 1 &amp; any 结果是 any。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IsAny&lt;T&gt; = <span class="string">&quot;a&quot;</span> <span class="keyword">extends</span> <span class="number">1</span> &amp; T ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="IsEqual"><a href="#IsEqual" class="headerlink" title="IsEqual"></a>IsEqual</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下这种写法不能判断 isAny，isEqual&lt;&#x27;a&#x27;, any&gt; 会返回 true</span></span><br><span class="line"><span class="keyword">type</span> IsEqual&lt;A, B&gt; = (A <span class="keyword">extends</span> B ? <span class="literal">true</span> : <span class="literal">false</span>) &amp;</span><br><span class="line">  (B <span class="keyword">extends</span> A ? <span class="literal">true</span> : <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下这个可以判断 IsEqual2&lt;&#x27;a&#x27;, any&gt; 会返回 false</span></span><br><span class="line"><span class="keyword">type</span> IsEqual2&lt;A, B&gt; = (&lt;T&gt;<span class="function">() =&gt;</span> T <span class="keyword">extends</span> A ? <span class="number">1</span> : <span class="number">2</span>) <span class="keyword">extends</span> &lt;</span><br><span class="line">  T</span><br><span class="line">&gt;<span class="function">() =&gt;</span> T <span class="keyword">extends</span> B ? <span class="number">1</span> : <span class="number">2</span></span><br><span class="line">  ? <span class="literal">true</span></span><br><span class="line">  : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="IsUnion"><a href="#IsUnion" class="headerlink" title="IsUnion"></a>IsUnion</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IsUnion&lt;A, B&gt; = A <span class="keyword">extends</span> A ? ([B] <span class="keyword">extends</span> [A] ? <span class="literal">false</span> : <span class="literal">true</span>) : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="IsNever"><a href="#IsNever" class="headerlink" title="IsNever"></a>IsNever</h3><p>never 在条件类型中也比较特殊，如果条件类型左边是类型参数，并且传入的是 never，那么直接返回 never。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TestNever&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">number</span> ? <span class="number">1</span> : <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 如下会返回 never</span></span><br><span class="line"><span class="keyword">type</span> result = TestNever&lt;<span class="built_in">never</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确的 IsNever</span></span><br><span class="line"><span class="keyword">type</span> IsNever&lt;T&gt; = [T] <span class="keyword">extends</span> [<span class="built_in">never</span>] ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>除此之外，any 在条件类型中也比较特殊，如果类型参数为 any，会直接返回 trueType 和 falseType 的合并。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TestAny&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">number</span> ? <span class="number">1</span> : <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 如下会返回 1 | 2</span></span><br><span class="line"><span class="keyword">type</span> result = TestAny&lt;<span class="built_in">any</span>&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="IsTuple"><a href="#IsTuple" class="headerlink" title="IsTuple"></a>IsTuple</h3><p>元组类型的 length 是数字字面量，而数组的 length 是 number。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IsTuple&lt;T&gt; = T <span class="keyword">extends</span> [...infer Eles]</span><br><span class="line">  ? NotEqual&lt;Ele[<span class="string">&quot;length&quot;</span>], <span class="built_in">number</span>&gt;</span><br><span class="line">  : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> NotEqual&lt;A, B&gt; = (&lt;T&gt;<span class="function">() =&gt;</span> T <span class="keyword">extends</span> A ? <span class="number">1</span> : <span class="number">2</span>) <span class="keyword">extends</span> &lt;</span><br><span class="line">  T</span><br><span class="line">&gt;<span class="function">() =&gt;</span> T <span class="keyword">extends</span> B ? <span class="number">1</span> : <span class="number">2</span></span><br><span class="line">  ? <span class="literal">false</span></span><br><span class="line">  : <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h3 id="UnionToIntersection"><a href="#UnionToIntersection" class="headerlink" title="UnionToIntersection"></a>UnionToIntersection</h3><p>联合类型转交叉类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UnionToIntersecion&lt;U&gt; = (U <span class="keyword">extends</span> U ? <span class="function">(<span class="params">x: U</span>) =&gt;</span> unknown : <span class="built_in">never</span>) <span class="keyword">extends</span> (</span><br><span class="line">  x: infer R</span><br><span class="line">) =&gt; unknown</span><br><span class="line">  ? R</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="GetOptional"><a href="#GetOptional" class="headerlink" title="GetOptional"></a>GetOptional</h3><p>提取索引类型中的可选索引。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetOptional&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> &#123;&#125; <span class="keyword">extends</span> Pick&lt;Obj, Key&gt; ? Key : <span class="built_in">never</span>]: Obj[Key];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pick 是 TS 内置高级类型</span></span><br><span class="line"><span class="keyword">type</span> Pick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123; [P <span class="keyword">in</span> K]: T[P] &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="GetRequired"><a href="#GetRequired" class="headerlink" title="GetRequired"></a>GetRequired</h3><p>提取索引类型中的非可选索引构造成新的索引类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> GetRequired&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> &#123;&#125; <span class="keyword">extends</span> Pick&lt;Obj, Key&gt; ? <span class="built_in">never</span> : Key]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="RemoveIndexSignature"><a href="#RemoveIndexSignature" class="headerlink" title="RemoveIndexSignature"></a>RemoveIndexSignature</h3><p>过滤掉索引类型中的可索引签名，构造成一个新的索引类型。<br>索引签名的特性：索引签名不能构造成字符串字面量类型，因为它没有名字，而其他索引可以</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RemoveIndexSignature&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> Key <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Str&#125;</span>`</span> ? Str : <span class="built_in">never</span>]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="ClassPublicProps"><a href="#ClassPublicProps" class="headerlink" title="ClassPublicProps"></a>ClassPublicProps</h3><p>过滤 class 的 public 属性。<br>根据特性：keyof 只能拿到 class 的 public 索引，private 和 protected 的索引会被忽略。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ClassPublicProps&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="as-const"><a href="#as-const" class="headerlink" title="as const"></a>as const</h3><p>TypeScript 默认推导出来的类型并不是字面量类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">type</span> objType = <span class="keyword">typeof</span> obj;</span><br><span class="line"><span class="comment">// type objType = &#123;</span></span><br><span class="line"><span class="comment">//     a: number;</span></span><br><span class="line"><span class="comment">//     b: number</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p>如果想要推到出字面量，就需要用 as const：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">type</span> arrType = <span class="keyword">typeof</span> arr;</span><br><span class="line"><span class="comment">// type arrType = number[];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"><span class="keyword">type</span> arrType2 = <span class="keyword">typeof</span> arr2;</span><br><span class="line"><span class="comment">// type arrType2 = readonly [1, 2, 3];</span></span><br></pre></td></tr></table></figure>

<p>反转 3 个元素的元组类型，需要加上 readonly 才能匹配成功。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReverseArr&lt;Arr&gt; = Arr <span class="keyword">extends</span> <span class="keyword">readonly</span> [infer A, infer B, infer C]</span><br><span class="line">  ? [C, B, A]</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h2 id="练一练"><a href="#练一练" class="headerlink" title="练一练"></a>练一练</h2><h3 id="实现-ParseQueryString"><a href="#实现-ParseQueryString" class="headerlink" title="实现 ParseQueryString"></a>实现 ParseQueryString</h3><p>将 ‘a=1&amp;b=2&amp;c=3’ 转成 {a: 1, b: 2, c: 3}</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ParseQueryString&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Param&#125;</span>&amp;<span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">    ? MergeParams&lt;ParseParams&lt;Param&gt;, ParseQueryString&lt;Rest&gt;&gt;</span><br><span class="line">    : ParseParam&lt;Str&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ParseParams&lt;Param <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">  Param <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Key&#125;</span>=<span class="subst">$&#123;infer Value&#125;</span>`</span></span><br><span class="line">    ? &#123;</span><br><span class="line">        [K <span class="keyword">in</span> Key]: Value;</span><br><span class="line">      &#125;</span><br><span class="line">    : Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MergeParams&lt;</span><br><span class="line">  OneParam <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">  OtherParam <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;</span><br><span class="line">&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof OneParam | keyof OtherParam]: Key <span class="keyword">extends</span> keyof OneParam</span><br><span class="line">    ? Key <span class="keyword">extends</span> keyof OtherParam</span><br><span class="line">      ? MergeValue&lt;OneParam[Key], OtherParam[Key]&gt;</span><br><span class="line">      : OneParam[Key]</span><br><span class="line">    : Key <span class="keyword">extends</span> keyof OtherParam</span><br><span class="line">    ? OtherParam[Key]</span><br><span class="line">    : <span class="built_in">never</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MergeValue&lt;One, Other&gt; = One <span class="keyword">extends</span> Other</span><br><span class="line">  ? One</span><br><span class="line">  : Other <span class="keyword">extends</span> unknown[]</span><br><span class="line">  ? [One, ...Other]</span><br><span class="line">  : [One, Other];</span><br></pre></td></tr></table></figure>

<h2 id="TS-内置的高级类型"><a href="#TS-内置的高级类型" class="headerlink" title="TS 内置的高级类型"></a>TS 内置的高级类型</h2><h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><p>提取函数类型的参数类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Parameters&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (</span><br><span class="line">  ...args: infer P</span><br><span class="line">) =&gt; <span class="built_in">any</span></span><br><span class="line">  ? P</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ReturnType"><a href="#ReturnType" class="headerlink" title="ReturnType"></a>ReturnType</h3><p>提取函数类型的返回值类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReturnType&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (</span><br><span class="line">  ...args: <span class="built_in">any</span></span><br><span class="line">) =&gt; infer R</span><br><span class="line">  ? R</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ConstructorParameters"><a href="#ConstructorParameters" class="headerlink" title="ConstructorParameters"></a>ConstructorParameters</h3><p>提取构造函数的参数类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ConstructorParameters&lt;T <span class="keyword">extends</span> <span class="keyword">new</span> (...ars: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> <span class="keyword">new</span> (</span><br><span class="line">  ...args: infer P</span><br><span class="line">) =&gt; <span class="built_in">any</span></span><br><span class="line">  ? P</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="InstanceType"><a href="#InstanceType" class="headerlink" title="InstanceType"></a>InstanceType</h3><p>提取构造器返回值类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> InstanceType&lt;T <span class="keyword">extends</span> <span class="keyword">new</span> (...ars: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> <span class="keyword">new</span> (</span><br><span class="line">  ...ars: <span class="built_in">any</span></span><br><span class="line">) =&gt; infer R</span><br><span class="line">  ? R</span><br><span class="line">  : <span class="built_in">any</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ThisParameterType"><a href="#ThisParameterType" class="headerlink" title="ThisParameterType"></a>ThisParameterType</h3><p>提取函数参数中 this 的类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ThisParameterType&lt;T&gt; = T <span class="keyword">extends</span> (<span class="built_in">this</span>: infer U, ...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span></span><br><span class="line">  ? U</span><br><span class="line">  : unknown;</span><br></pre></td></tr></table></figure>

<h3 id="OmitThisParameter"><a href="#OmitThisParameter" class="headerlink" title="OmitThisParameter"></a>OmitThisParameter</h3><p>去除函数参数中的 this 类型，并且返回一个新的类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> OmitThisParameter&lt;T&gt; =</span><br><span class="line">    unknown <span class="keyword">extends</span> ThisParameterType&lt;T&gt;</span><br><span class="line">        ? T</span><br><span class="line">        : T <span class="keyword">extends</span> (...args: infer A) =&gt; infer R</span><br><span class="line">            ? （...args: A） =&gt; infer R</span><br><span class="line">            : T;</span><br></pre></td></tr></table></figure>

<h3 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h3><p>把索引类型的所有索引变成可选类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Partial&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Required"><a href="#Required" class="headerlink" title="Required"></a>Required</h3><p>把索引类型里可选索引改成必选索引</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Required&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]-?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a>Readonly</h3><p>索引类型的索引添加只读</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Readonly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Pick"><a href="#Pick" class="headerlink" title="Pick"></a>Pick</h3><p>过滤出指定的索引类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Pick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h3><p>创建索引类型</p>
<blockquote>
<p>keyof any 会返回 string | number | symbol</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Record&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果 Record 里的第一个参数是 string | number | symbol，那么创建的就是索引签名索引类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RecordRes = Record&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt;;</span><br><span class="line"><span class="comment">// RecordRes = &#123;</span></span><br><span class="line"><span class="comment">//     [x: string]: number;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Exclude"><a href="#Exclude" class="headerlink" title="Exclude"></a>Exclude</h3><p>去掉联合类型中的某些类型，即取差集</p>
<p>联合类型当作为类型参数出现在条件类型左边时，会被分散成单个类型传入，这叫做分布式条件类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Exclude&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br></pre></td></tr></table></figure>

<h3 id="Extract"><a href="#Extract" class="headerlink" title="Extract"></a>Extract</h3><p>提取联合类型中的某些类型，即取交集</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Extract&lt;T, U&gt; = T <span class="keyword">extends</span> U ? T : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h3><p>去掉某部分索引类型的索引构成新索引类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Omit&lt;T, K <span class="keyword">in</span> keyof <span class="built_in">any</span>&gt; = Pick&lt;T, EXclude&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="Awaited"><a href="#Awaited" class="headerlink" title="Awaited"></a>Awaited</h3><p>提取 Promise 的返回值类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Awaited&lt;T&gt; =</span><br><span class="line">    T <span class="keyword">extends</span> <span class="literal">null</span> | <span class="literal">undefined</span></span><br><span class="line">        ? T</span><br><span class="line">        : T <span class="keyword">extends</span> <span class="built_in">object</span> &amp; &#123; then(onfulfilled: infer F): <span class="built_in">any</span>&#125;</span><br><span class="line">            ? F <span class="keyword">extends</span> (<span class="function">(<span class="params">value, infer V, ...ars: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">any</span>)</span><br><span class="line">                ? Awaited&lt;V&gt;</span><br><span class="line">                : <span class="built_in">never</span></span><br><span class="line">            : T;</span><br></pre></td></tr></table></figure>

<h3 id="NonNullable"><a href="#NonNullable" class="headerlink" title="NonNullable"></a>NonNullable</h3><p>判断是否是空类型，即不是 null 或 undefined</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NonNullable&lt;T&gt; = T <span class="keyword">extends</span> <span class="literal">null</span> | unfefined ? <span class="built_in">never</span> : T;</span><br></pre></td></tr></table></figure>

<h3 id="Uppercase、Lowercase、Capitalize、Uncapitalize"><a href="#Uppercase、Lowercase、Capitalize、Uncapitalize" class="headerlink" title="Uppercase、Lowercase、Capitalize、Uncapitalize"></a>Uppercase、Lowercase、Capitalize、Uncapitalize</h3><p>这几个类型分别是实现大写、小写、首字母大写、去掉首字母大写的。<br>他们的实现是直接用 js 实现的。</p>
<h2 id="综合实战"><a href="#综合实战" class="headerlink" title="综合实战"></a>综合实战</h2><h3 id="KebabCaseToCamelCase"><a href="#KebabCaseToCamelCase" class="headerlink" title="KebabCaseToCamelCase"></a>KebabCaseToCamelCase</h3><p>‘aa-bb-cc’ 这种是 KebabCase，而 ‘aaBbCc’ 这种是 CamelCase</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> KebabCaseToCamelCase&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Item&#125;</span>-<span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">    ? <span class="string">`<span class="subst">$&#123;Item&#125;</span><span class="subst">$&#123;KebabCaseToCamelCase&lt;Capitalize&lt;Rest&gt;&gt;&#125;</span>`</span></span><br><span class="line">    : Str;</span><br></pre></td></tr></table></figure>

<h3 id="CamelCaseToKebabCase"><a href="#CamelCaseToKebabCase" class="headerlink" title="CamelCaseToKebabCase"></a>CamelCaseToKebabCase</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CamelCaseToKebabCase&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; =</span><br><span class="line">  Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer First&#125;</span><span class="subst">$&#123;infer Rest&#125;</span>`</span></span><br><span class="line">    ? First <span class="keyword">extends</span> Lowercase&lt;First&gt;</span><br><span class="line">      ? <span class="string">`<span class="subst">$&#123;First&#125;</span><span class="subst">$&#123;CamelCaseToKebabCase&lt;Rest&gt;&#125;</span>`</span></span><br><span class="line">      : <span class="string">`-<span class="subst">$&#123;Lowercase&lt;First&gt;&#125;</span><span class="subst">$&#123;CamelCaseToKebabCase&lt;Rest&gt;&#125;</span>`</span></span><br><span class="line">    : Str;</span><br></pre></td></tr></table></figure>

<h3 id="Chunk"><a href="#Chunk" class="headerlink" title="Chunk"></a>Chunk</h3><p>对数组做分组，比如 1、2、3、4、5 的数组，每两个为 1 组，那就可以分为 1、2 和 3、4 以及 5 这三个 Chunk。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Chunk&lt;</span><br><span class="line">  Arr <span class="keyword">extends</span> unknown[],</span><br><span class="line">  ItemLen <span class="keyword">extends</span> <span class="built_in">number</span>,</span><br><span class="line">  CurItem <span class="keyword">extends</span> unknown[] = [],</span><br><span class="line">  Res <span class="keyword">extends</span> unknown[] = []</span><br><span class="line">&gt; = Arr <span class="keyword">extends</span> [infer First, ...infer Rest]</span><br><span class="line">  ? CurItem[<span class="string">&quot;length&quot;</span>] <span class="keyword">extends</span> ItemLen</span><br><span class="line">    ? Chunk&lt;Rest, ItemLen, [First], [...Res, CurItem]&gt;</span><br><span class="line">    : Chunk&lt;Rest, ItemLen, [...CurItem, First], Res&gt;</span><br><span class="line">  : [...Res, CurItem];</span><br></pre></td></tr></table></figure>

<h3 id="TupleToNestedObject"><a href="#TupleToNestedObject" class="headerlink" title="TupleToNestedObject"></a>TupleToNestedObject</h3><p>根据数组类型，比如 [‘a’, ‘b’, ‘c’] 的元组类型，再加上值的类型 ‘xxx’，构造出这样的索引类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  a: &#123;</span><br><span class="line">    b: &#123;</span><br><span class="line">      c: <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TupleToNestedObject&lt;Tuple <span class="keyword">extends</span> unknown[], ValueType&gt; = Tuple <span class="keyword">extends</span> [</span><br><span class="line">  infer First,</span><br><span class="line">  ...infer Rest</span><br><span class="line">]</span><br><span class="line">  ? &#123;</span><br><span class="line">      [Key <span class="keyword">in</span> First <span class="keyword">as</span> Key <span class="keyword">extends</span> keyof <span class="built_in">any</span></span><br><span class="line">        ? Key</span><br><span class="line">        : <span class="built_in">never</span>]: Rest <span class="keyword">extends</span> unknown[]</span><br><span class="line">        ? TupleToNestedObject&lt;Rest, ValueType&gt;</span><br><span class="line">        : ValueType;</span><br><span class="line">    &#125;</span><br><span class="line">  : ValueType;</span><br></pre></td></tr></table></figure>

<h3 id="PartialObjectPropByKeys"><a href="#PartialObjectPropByKeys" class="headerlink" title="PartialObjectPropByKeys"></a>PartialObjectPropByKeys</h3><p>把一个索引类型的某些 Key 转为 可选的，其余的 Key 不变。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PartialObjectPropByKeys&lt;</span><br><span class="line">  Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">  Key <span class="keyword">extends</span> keyof <span class="built_in">any</span></span><br><span class="line">&gt; = Partial&lt;Pick&lt;Obj, Extract&lt;keyof Obj, Key&gt;&gt;&gt; &amp; Omit&lt;Obj, Key&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PartialObjectPropByKeys2&lt;</span><br><span class="line">  Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">  KeyType <span class="keyword">extends</span> keyof <span class="built_in">any</span></span><br><span class="line">&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj <span class="keyword">as</span> Key <span class="keyword">extends</span> KeyType ? Key? : Key]: Obj[Key];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="函数重载的三种写法"><a href="#函数重载的三种写法" class="headerlink" title="函数重载的三种写法"></a>函数重载的三种写法</h3><p><strong>第一种</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title">number</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a: <span class="built_in">string</span>, b: <span class="built_in">string</span></span>): <span class="title">string</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a: <span class="built_in">any</span>, b: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>第二种</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Func &#123;</span><br><span class="line">  (a: <span class="built_in">number</span>, b: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">  (a: <span class="built_in">string</span>, b: <span class="built_in">string</span>): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> add: Func = <span class="function">(<span class="params">a: <span class="built_in">any</span>, b: <span class="built_in">any</span></span>) =&gt;</span> a + b;</span><br></pre></td></tr></table></figure>

<p><strong>第三种</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Func = (<span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span>) &amp; ((a: <span class="built_in">string</span>, b: <span class="built_in">string</span>): <span class="built_in">string</span>)</span><br><span class="line"><span class="keyword">const</span> add: Func = <span class="function">(<span class="params">a: <span class="built_in">any</span>, b: <span class="built_in">any</span></span>) =&gt;</span> a + b;</span><br></pre></td></tr></table></figure>

<h3 id="UnionToTuple"><a href="#UnionToTuple" class="headerlink" title="UnionToTuple"></a>UnionToTuple</h3><p>将联合类型转成元组。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UnionToTuple&lt;T&gt; = UnionToIntersection&lt;</span><br><span class="line">  T <span class="keyword">extends</span> <span class="built_in">any</span> ? <span class="function">() =&gt;</span> T : <span class="built_in">never</span></span><br><span class="line">&gt; <span class="keyword">extends</span> () =&gt; infer ReturnType</span><br><span class="line">  ? [...UnionToTuple&lt;Exclude&lt;T, ReturnType&gt;&gt;, ReturnType]</span><br><span class="line">  : [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 联合转交叉</span></span><br><span class="line"><span class="keyword">type</span> UnionToIntersection&lt;U&gt; = (</span><br><span class="line">  U <span class="keyword">extends</span> U ? <span class="function">(<span class="params">x: U</span>) =&gt;</span> unknown : <span class="built_in">never</span></span><br><span class="line">) <span class="keyword">extends</span> (x: infer R) =&gt; unknown</span><br><span class="line">  ? R</span><br><span class="line">  : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>实现一个类似的效果，将：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> res = join(<span class="string">&quot;-&quot;</span>)(<span class="string">&quot;guang&quot;</span>, <span class="string">&quot;and&quot;</span>, <span class="string">&quot;dong&quot;</span>);</span><br><span class="line"><span class="comment">// 转成 res = &#x27;guang-and-dong&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>join 代码实现</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">join</span>&lt;<span class="title">Delimiter</span> <span class="title">extends</span> <span class="title">string</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  delimiter: Delimiter</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): &lt;<span class="title">Items</span> <span class="title">extends</span> <span class="title">string</span>[]&gt;(<span class="params">...parts: Items</span>) =&gt; <span class="title">JoinType</span>&lt;<span class="title">Items</span>, <span class="title">Delimiter</span>&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JoinType&lt;</span><br><span class="line">  Items <span class="keyword">extends</span> <span class="built_in">any</span>[],</span><br><span class="line">  Delimiter <span class="keyword">extends</span> <span class="built_in">string</span>,</span><br><span class="line">  Result <span class="keyword">extends</span> <span class="built_in">string</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">&gt; = Items <span class="keyword">extends</span> [infer First, ...infer Rest]</span><br><span class="line">  ? JoinType&lt;Rest, Delimiter, <span class="string">`<span class="subst">$&#123;Result&#125;</span><span class="subst">$&#123;First &amp; <span class="built_in">string</span>&#125;</span>-`</span>&gt;</span><br><span class="line">  : RemoveLastDelimiter&lt;Result&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RemoveLastDelimiter&lt;Str <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Rest&#125;</span>-`</span></span><br><span class="line">  ? Rest</span><br><span class="line">  : Str;</span><br></pre></td></tr></table></figure>

<h3 id="AllKeyPath"><a href="#AllKeyPath" class="headerlink" title="AllKeyPath"></a>AllKeyPath</h3><p>拿到一个索引类型的所有 key 的路径。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AllKeyPath&lt;Obj <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;&gt; = &#123;</span><br><span class="line">  [Key <span class="keyword">in</span> keyof Obj]: Key <span class="keyword">extends</span> <span class="built_in">string</span></span><br><span class="line">    ? Obj[Key] <span class="keyword">extends</span> Record&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;</span><br><span class="line">      ? Key | <span class="string">`<span class="subst">$&#123;Key&#125;</span>.<span class="subst">$&#123;AllKeyPath&lt;Obj[Key]&gt;&#125;</span>`</span></span><br><span class="line">      : Key</span><br><span class="line">    : <span class="built_in">never</span>;</span><br><span class="line">&#125;[keyof Obj];</span><br></pre></td></tr></table></figure>

<h3 id="Defaultize"><a href="#Defaultize" class="headerlink" title="Defaultize"></a>Defaultize</h3><p>实现这样一个高级类型，对 A、B 两个索引类型做合并，如果是只有 A 中有的不变，如果是 A、B 都有的就变为可选，只有 B 中有的也变为可选。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Defaultize&lt;A, B&gt; = Pick&lt;A, Exclude&lt;keyof A, keyof B&gt;&gt; &amp;</span><br><span class="line">  Partial&lt;Pick&lt;A, Extract&lt;keyof A, keyof B&gt;&gt;&gt; &amp;</span><br><span class="line">  Partial&lt;Pick&lt;B, Exclude&lt;keyof B, keyof A&gt;&gt;&gt;;</span><br></pre></td></tr></table></figure>

<h2 id="infer-extends"><a href="#infer-extends" class="headerlink" title="infer extends"></a>infer extends</h2><h3 id="枚举值转联合类型"><a href="#枚举值转联合类型" class="headerlink" title="枚举值转联合类型"></a>枚举值转联合类型</h3><p>以下会把枚举的数值类型转成字符串类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Code &#123;</span><br><span class="line">  a = <span class="number">111</span>,</span><br><span class="line">  b = <span class="number">222</span>,</span><br><span class="line">  c = <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> res = <span class="string">`<span class="subst">$&#123;Code&#125;</span>`</span>;</span><br><span class="line"><span class="comment">// res = &#x27;111&#x27; | &#x27;222&#x27; | &#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="StrToNum"><a href="#StrToNum" class="headerlink" title="StrToNum"></a>StrToNum</h3><p>使用 infer extends 后就就可以正常使用了。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Code &#123;</span><br><span class="line">  a = <span class="number">111</span>,</span><br><span class="line">  b = <span class="number">222</span>,</span><br><span class="line">  c = <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> StrToNum&lt;Str&gt; = Str <span class="keyword">extends</span> <span class="string">`<span class="subst">$&#123;infer Num <span class="keyword">extends</span> <span class="built_in">number</span>&#125;</span>`</span> ? Num : Str;</span><br><span class="line"><span class="keyword">type</span> res = StrToNum&lt;<span class="string">`<span class="subst">$&#123;Code&#125;</span>`</span>&gt;;</span><br><span class="line"><span class="comment">// res = &#x27;abc&#x27; | 111 | 222</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="right-container"><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2024/06/06/mac-terminal-command/" title="mac 终端命令大全" class="prev">上一篇</a><a href="/2024/02/02/micro-desc/" title="微前端的几种架构介绍" class="next">下一篇</a></div><a href="#comment" class="comment-anchor"></a><div id="vcomments"></div><script>new Valine({
    el: "#vcomments",
    appId: "aD8jJBpu4oew3ovNY73z6Rdq-gzGzoHsz",
    appKey: "FdzS5SOPHdhYQoEUngQ8K2QW",
    notify: false,
    verify: false,
    avatar: "robohash",
    visitor: true,
    placeholder: "随便说点什么～.～",
});</script><div class="copyright"><p>© 2016 - 2024 <a href="https://weibo.com/316000381" target="_blank">typeR</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p><p><span id="busuanzi_container_site_pv">本站总访问数：<span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv" style="padding-left: 6px;">访客数：<span id="busuanzi_value_site_uv"></span></span></p><p> <span style="padding-right: 6px;">闽ICP备16007301号-2</span></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/jquery-1.8.2.min.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/articleCatalog.js"></script><script src="https://bubuzou.oss-cn-shenzhen.aliyuncs.com/blog/202010/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>